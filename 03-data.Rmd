# Downloading and loading data {#data}

A vital skill for doing using GIS skills to solve real-world problems is finding, downloading and importing data.

Often, the first stage in the data downloading/loading process is to find the data online. 
In this case we will access data from the following site, which contains data we prepared earlier for the course: [github.com/ITSLeeds/SSPA/releases](https://github.com/ITSLeeds/SSPA/releases/download/v1.1).

```{r, echo=FALSE}
if(!dir.exists("QGISforSSPAdata/")) {
  u = "https://github.com/ITSLeeds/SSPA/releases/download/v1.1/QGISforSSPAdata.zip"
  download.file(u, "QGISforSSPAdata.zip")
  unzip("QGISforSSPAdata.zip")
}
```

Look at the file in your explorer...

To open a file in QGIS first create a QGIS project.


## Importing spatial data

To load a spatial data file, click on the Data Source Manager button in the top left corner of QGIS (see Figure \@ref(fig:data-source-manager)).

```{r data-source-manager, out.width="50%", fig.cap="The Data Source Manager icon", echo=FALSE}
knitr::include_graphics("figures/open-data-source-manager.jpg")
```

We will use the leeds_lsoa.shp example file to plot the boundaries of the Lower Layer Super Output Areas in Leeds.

Open the Data Source Manager and select “Vector” then specify the “File Name” and location, or use the … to navigate to the file.

Click “Add” then “Close”.

```{r data-source-manager-shp, out.width="50%", fig.cap="The Data Source Manager - Vector", echo=FALSE}
knitr::include_graphics("figures/import_shp.jpg")
```


## Importing a CSV or text file

### CSV with spatial data

Sometimes you have data that contains spatial information but is not in a spatial data format.  A common example is to have a CSV file with latitude and longitude columns. CSV is a common format for storing data and can be opened by lots of different software, including Microsoft Excel. 
We will use the stats19.csv example file to plot the location of vehicles collisions in Leeds.

Open the Data Source Manager and select “Delimited Text” then specify the “File Name” and location, or use the … to navigate to the file.
Under the “Geometry definition” select “Point coordinates” and set the “X field” to “longitude” and the “Y field” to “latitude”.  Set the “Geometry CRS” to “EPSG: 4326 – WGS 84”.

Click “Add” then “Close”.

```{r data-source-manager-csv, out.width="50%", fig.cap="The Data Source Manager - Delimited Text", echo=FALSE}
knitr::include_graphics("figures/import_csv.jpg")
```

### CSV without spatial data

QGIS will also allow you to import non-spatial data. Import the population.csv example file for later use using the same process as above, but selecting “No geometry (attribute only table)”

## Joining Data

Joining data allows you to link two separate datasets together by something they have in common. There are two types of join.  Attribute joins (often just called joins) link two datasets by a common attribute such as an ID number. Spatial joins link dataset by a shared location.

### Attribute Joins

We will join the population data onto the LSOA boundaries.

Find “leeds_lsoa” in the Layers panel and right-click to bring up the context menu

Click on Properties

Select Joins from the options on the left

Click the green + button to open the Add Vector Join window

Select the following options:

	Join layer: population
	
	Join field: area
	
	Target field: lsoa11cd
	
Click OK,

Click OK again

```{r joins, out.width="50%", fig.cap="The Add Vector Join window", echo=FALSE}
knitr::include_graphics("figures/joins.jpg")
```


Use the “Identify features” tool to see that each LSOA now has a population value.

### Spatial Joins
We will assign an LSOA ID number to each road collision by doing a spatial join.  
In the “Vector” menu, select “Data Management Tools”, then “Join Attributes by Location”.

```{r joins_menu, out.width="50%", fig.cap="Join Attributes by Location", echo=FALSE}
knitr::include_graphics("figures/spatial_joins.jpg")
```


```{r joins_window, out.width="50%", fig.cap="Join Attributes by Location Window", echo=FALSE}
knitr::include_graphics("figures/spatial_joins_window.jpg")
```


```{r joins_result, out.width="50%", fig.cap="Join Results", echo=FALSE}
knitr::include_graphics("figures/spatial_join_result.jpg")
```
